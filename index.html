<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>วิมานอสังหาริมทรัพย์ | ซื้อ-ขาย-เช่าบ้าน 3D Virtual Tour พร้อมระบบลงประกาศฟรี</title>
    <meta name="description" content="แพลตฟอร์มอสังหาริมทรัพย์ครบวงจร พร้อมเทคโนโลยี 3D Virtual Tour ระบบลงประกาศฟรี และค้นหาบ้านที่สมบูรณ์แบบ">
    <meta name="keywords" content="ขายบ้าน, ซื้อบ้าน, อสังหาริมทรัพย์, 3D Virtual Tour, ลงประกาศฟรี, บ้านเดี่ยว, คอนโด, ที่ดิน">
    <meta property="og:title" content="วิมานอสังหาริมทรัพย์ | ระบบอสังหาริมทรัพย์ครบวงจร">
    <meta property="og:description" content="ค้นพบบ้านในฝันด้วยเทคโนโลยี 3D Virtual Tour และระบบลงประกาศฟรี">
    <meta property="og:type" content="website">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700;800&family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --primary: #0f4c81;
            --secondary: #e6b325;
            --accent: #e74c3c;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, .brand {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header & Navigation */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            transition: var(--transition);
        }
        
        .header-scrolled {
            padding: 10px 0;
            background-color: rgba(255, 255, 255, 0.98);
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            transition: var(--transition);
        }
        
        .header-scrolled .header-container {
            padding: 10px 0;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), #2c5364);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            box-shadow: 0 5px 15px rgba(15, 76, 129, 0.3);
        }
        
        .brand-text h1 {
            font-size: 1.8rem;
            color: var(--primary);
            letter-spacing: 1px;
            line-height: 1.2;
        }
        
        .brand-text p {
            font-size: 0.9rem;
            color: var(--gray);
            font-weight: 300;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            font-size: 1.1rem;
            transition: var(--transition);
            position: relative;
        }
        
        nav a:hover {
            color: var(--primary);
        }
        
        nav a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: var(--transition);
        }
        
        nav a:hover::after {
            width: 100%;
        }
        
        .cta-button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(15, 76, 129, 0.3);
        }
        
        .cta-button:hover {
            background-color: #0c3d6b;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(15, 76, 129, 0.4);
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--primary);
            cursor: pointer;
        }
        
        /* Hero Section with 3D */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding-top: 100px;
            background: linear-gradient(135deg, rgba(15, 76, 129, 0.9), rgba(44, 83, 100, 0.9)), url('https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .hero-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
        }
        
        .hero-text h2 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .hero-text p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
            max-width: 90%;
        }
        
        .hero-features {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 40px;
        }
        
        .feature {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature i {
            color: var(--secondary);
            font-size: 1.5rem;
        }
        
        /* 3D House Cube in Hero */
        .hero-3d {
            perspective: 1500px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .cube-container {
            width: 400px;
            height: 400px;
            position: relative;
            transform-style: preserve-3d;
            animation: rotateCube 25s infinite linear;
        }
        
        .cube-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            backface-visibility: hidden;
        }
        
        .cube-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .front  { transform: translateZ(200px); }
        .back   { transform: rotateY(180deg) translateZ(200px); }
        .right  { transform: rotateY(90deg) translateZ(200px); }
        .left   { transform: rotateY(-90deg) translateZ(200px); }
        .top    { transform: rotateX(90deg) translateZ(200px); }
        .bottom { transform: rotateX(-90deg) translateZ(200px); }
        
        @keyframes rotateCube {
            0% { transform: rotateX(-10deg) rotateY(0deg); }
            100% { transform: rotateX(-10deg) rotateY(360deg); }
        }
        
        /* Header Dropdown Form */
        .header-form-dropdown {
            position: relative;
        }
        
        .form-dropdown-content {
            position: absolute;
            top: calc(100% + 15px);
            right: 0;
            width: 400px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-20px);
            transition: var(--transition);
            overflow: hidden;
        }
        
        .form-dropdown-content.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .form-dropdown-header {
            background-color: var(--primary);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-form-dropdown {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .form-dropdown-body {
            max-height: 60vh;
            overflow-y: auto;
            padding: 25px;
        }
        
        /* Property Listing Form in Dropdown */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Kanit', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .form-group.full-width {
            width: 100%;
        }
        
        .image-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
        }
        
        .image-upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(15, 76, 129, 0.05);
        }
        
        .image-upload-area i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        #image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .preview-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .submit-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(15, 76, 129, 0.3);
            flex: 1;
        }
        
        .submit-btn:hover {
            background-color: #0c3d6b;
            transform: translateY(-2px);
        }
        
        .reset-btn {
            background-color: #f8f9fa;
            color: var(--dark);
            border: 2px solid #e0e0e0;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
        }
        
        .reset-btn:hover {
            background-color: #e9ecef;
        }
        
        /* Dropdown สำหรับเลือกภาพ */
        .dropdown-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .dropdown-header {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .dropdown-header:hover {
            border-color: var(--primary);
        }
        
        .dropdown-header.active {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(15, 76, 129, 0.1);
        }
        
        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 0 0 8px 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .dropdown-options.active {
            display: block;
        }
        
        .dropdown-option {
            padding: 10px 12px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .dropdown-option:hover {
            background-color: rgba(15, 76, 129, 0.05);
        }
        
        .dropdown-option.selected {
            background-color: rgba(15, 76, 129, 0.1);
            font-weight: 600;
            color: var(--primary);
        }
        
        .dropdown-option img {
            width: 30px;
            height: 30px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .dropdown-hint {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Properties Section */
        .section-title {
            text-align: center;
            margin-bottom: 60px;
        }
        
        .section-title h2 {
            font-size: 2.8rem;
            color: var(--primary);
            margin-bottom: 15px;
            position: relative;
            display: inline-block;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background-color: var(--secondary);
        }
        
        .section-title p {
            color: var(--gray);
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .properties-section {
            padding: 100px 0;
            background-color: #f5f7fb;
        }
        
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 40px;
        }
        
        .property-card {
            background-color: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            opacity: 0;
            transform: translateY(30px);
        }
        
        .property-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .property-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }
        
        .property-image-slider {
            position: relative;
            height: 250px;
            overflow: hidden;
        }
        
        .slider-container {
            display: flex;
            width: 300%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .slider-container img {
            width: 33.333%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
        }
        
        .slider-nav {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .slider-dot.active {
            background-color: white;
            transform: scale(1.2);
        }
        
        .slider-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.8);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            opacity: 0;
        }
        
        .property-card:hover .slider-arrow {
            opacity: 1;
        }
        
        .slider-arrow:hover {
            background-color: white;
        }
        
        .slider-arrow.left {
            left: 15px;
        }
        
        .slider-arrow.right {
            right: 15px;
        }
        
        .property-content {
            padding: 25px;
        }
        
        .property-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .property-header h3 {
            font-size: 1.6rem;
            color: var(--dark);
        }
        
        .price {
            background-color: var(--primary);
            color: white;
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .property-location {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            margin-bottom: 15px;
        }
        
        .property-location i {
            color: var(--primary);
        }
        
        .property-features {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .feature-item {
            text-align: center;
        }
        
        .feature-item i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .feature-item span {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .property-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 15px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background-color: #0c3d6b;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--dark);
            flex: 1;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .btn-accent {
            background-color: var(--accent);
            color: white;
            flex: 1;
        }
        
        .btn-accent:hover {
            background-color: #c0392b;
        }
        
        /* Property Modal */
        .property-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .property-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .property-modal-content {
            background-color: white;
            border-radius: 20px;
            width: 90%;
            max-width: 1000px;
            height: 85vh;
            overflow-y: auto;
            position: relative;
            transform: scale(0.9);
            transition: var(--transition);
        }
        
        .property-modal.active .property-modal-content {
            transform: scale(1);
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--dark);
            cursor: pointer;
            transition: var(--transition);
            z-index: 10;
        }
        
        .close-modal:hover {
            color: var(--primary);
            transform: rotate(90deg);
        }
        
        .modal-property-images {
            height: 350px;
            position: relative;
        }
        
        .modal-slider-container {
            display: flex;
            width: 400%;
            height: 100%;
            transition: transform 0.5s ease;
        }
        
        .modal-slide {
            width: 25%;
            height: 100%;
        }
        
        .modal-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .modal-slider-nav {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .modal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .modal-dot.active {
            background-color: white;
            transform: scale(1.2);
        }
        
        .modal-property-details {
            padding: 30px;
        }
        
        .modal-property-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .modal-property-header h3 {
            font-size: 2rem;
            color: var(--primary);
        }
        
        .modal-price {
            font-size: 2rem;
            color: var(--primary);
            font-weight: 700;
        }
        
        .modal-location {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-description {
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.8;
            color: #555;
        }
        
        .modal-features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .modal-feature {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal-feature i {
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .modal-map {
            margin-top: 40px;
            border-radius: 15px;
            overflow: hidden;
            height: 300px;
        }
        
        /* 360 Viewer Modal - IMPROVED */
        .viewer-360-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .viewer-360-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .viewer-content {
            width: 90%;
            max-width: 1000px;
            height: 85%;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            transform: scale(0.9);
            transition: var(--transition);
        }
        
        .viewer-360-modal.active .viewer-content {
            transform: scale(1);
        }
        
        .viewer-header {
            padding: 15px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-viewer {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
        }
        
        .viewer-body {
            height: calc(100% - 60px);
            display: flex;
            justify-content: center;
            align-items: center;
            background: #1a1a1a;
            position: relative;
            overflow: hidden;
        }
        
        .panorama-viewer {
            width: 100%;
            height: 100%;
            position: relative;
            cursor: grab;
            overflow: hidden;
            perspective: 1000px;
        }
        
        .panorama-viewer:active {
            cursor: grabbing;
        }
        
        .panorama-sphere {
            width: 200%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-size: cover;
            background-position: center;
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out;
            will-change: transform;
        }
        
        .viewer-instruction {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 1.1rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            backdrop-filter: blur(5px);
            z-index: 10;
        }
        
        .viewer-controls {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .viewer-control-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: var(--transition);
        }
        
        .viewer-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        /* 3D Tour Modal - IMPROVED */
        .tour-3d-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .tour-3d-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .tour-content {
            width: 95%;
            height: 90%;
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            transform: scale(0.9);
            transition: var(--transition);
        }
        
        .tour-3d-modal.active .tour-content {
            transform: scale(1);
        }
        
        .tour-header {
            padding: 15px 20px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: absolute;
            top: 0;
            width: 100%;
            z-index: 10;
        }
        
        .close-tour {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
        }
        
        #tour3d-container {
            width: 100%;
            height: 100%;
        }
        
        .tour-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
        }
        
        .tour-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tour-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* Map Section */
        .map-section {
            padding: 100px 0;
            background-color: white;
        }
        
        .map-container {
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            height: 500px;
            margin-top: 40px;
        }
        
        #interactive-map {
            width: 100%;
            height: 100%;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 70px 0 30px;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 50px;
        }
        
        .footer-col h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: white;
            position: relative;
        }
        
        .footer-col h3::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--secondary);
        }
        
        .footer-col p {
            margin-bottom: 20px;
            opacity: 0.8;
        }
        
        .footer-col ul {
            list-style: none;
        }
        
        .footer-col ul li {
            margin-bottom: 15px;
        }
        
        .footer-col ul li a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-col ul li a:hover {
            color: var(--secondary);
            padding-left: 5px;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: white;
            transition: var(--transition);
        }
        
        .social-links a:hover {
            background-color: var(--secondary);
            transform: translateY(-5px);
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .hero-container {
                grid-template-columns: 1fr;
                text-align: center;
                gap: 40px;
            }
            
            .hero-text p {
                max-width: 100%;
            }
            
            .hero-3d {
                order: -1;
            }
            
            .cube-container {
                width: 300px;
                height: 300px;
            }
            
            .front, .back, .right, .left, .top, .bottom {
                transform: translateZ(150px);
            }
            
            .right  { transform: rotateY(90deg) translateZ(150px); }
            .left   { transform: rotateY(-90deg) translateZ(150px); }
            .top    { transform: rotateX(90deg) translateZ(150px); }
            .bottom { transform: rotateX(-90deg) translateZ(150px); }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .header-container {
                padding: 15px 0;
            }
            
            nav {
                position: fixed;
                top: 90px;
                left: 0;
                width: 100%;
                background-color: white;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                padding: 20px;
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: var(--transition);
            }
            
            nav.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            nav ul {
                flex-direction: column;
                gap: 20px;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .hero-text h2 {
                font-size: 2.5rem;
            }
            
            .section-title h2 {
                font-size: 2.2rem;
            }
            
            .properties-grid {
                grid-template-columns: 1fr;
            }
            
            .property-modal-content {
                width: 95%;
                height: 90vh;
            }
            
            .modal-property-images {
                height: 250px;
            }
            
            .tour-content {
                width: 98%;
                height: 95%;
            }
            
            .form-dropdown-content {
                width: 90vw;
                right: -10px;
            }
        }
        
        @media (max-width: 576px) {
            .hero-text h2 {
                font-size: 2rem;
            }
            
            .cube-container {
                width: 250px;
                height: 250px;
            }
            
            .front, .back, .right, .left, .top, .bottom {
                transform: translateZ(125px);
            }
            
            .right  { transform: rotateY(90deg) translateZ(125px); }
            .left   { transform: rotateY(-90deg) translateZ(125px); }
            .top    { transform: rotateX(90deg) translateZ(125px); }
            .bottom { transform: rotateX(-90deg) translateZ(125px); }
            
            .property-buttons {
                flex-direction: column;
            }
            
            .form-dropdown-body {
                padding: 20px;
            }
            
            .modal-price {
                font-size: 1.5rem;
            }
            
            .tour-controls {
                flex-wrap: wrap;
                justify-content: center;
                bottom: 10px;
            }
            
            .tour-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .form-dropdown-content {
                width: 95vw;
                right: -10px;
            }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }
        
        .loading-spinner.active {
            display: block;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(15, 76, 129, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header & Navigation -->
    <header id="header">
        <div class="container header-container">
            <div class="brand">
                <div class="logo">
                    <i class="fas fa-home"></i>
                </div>
                <div class="brand-text">
                    <h1>วิมานอสังหาริมทรัพย์</h1>
                    <p>เทคโนโลยี 3D Virtual Tour</p>
                </div>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav id="mainNav">
                <ul>
                    <li><a href="#home">หน้าแรก</a></li>
                    <li><a href="#properties">ค้นหาบ้าน</a></li>
                    <li><a href="#mapSection">แผนที่</a></li>
                    <li><a href="#contact">ติดต่อเรา</a></li>
                </ul>
            </nav>
            
            <div class="header-form-dropdown">
                <button class="cta-button" id="openFormDropdown">
                    ลงประกาศฟรี <i class="fas fa-plus"></i>
                </button>
                
                <div class="form-dropdown-content" id="formDropdown">
                    <div class="form-dropdown-header">
                        <h3>ลงประกาศขาย/เช่าฟรี</h3>
                        <button class="close-form-dropdown" id="closeFormDropdown">&times;</button>
                    </div>
                    
                    <div class="form-dropdown-body">
                        <form id="propertyForm">
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="propertyTitle">ชื่อประกาศ *</label>
                                    <input type="text" id="propertyTitle" placeholder="เช่น บ้านเดี่ยวหรู 2 ชั้น" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="propertyType">ประเภท *</label>
                                    <select id="propertyType" required>
                                        <option value="">เลือกประเภท</option>
                                        <option value="บ้านเดี่ยว">บ้านเดี่ยว</option>
                                        <option value="ทาวน์เฮ้าส์">ทาวน์เฮ้าส์</option>
                                        <option value="คอนโดมิเนียม">คอนโดมิเนียม</option>
                                        <option value="ที่ดิน">ที่ดิน</option>
                                        <option value="อาคารพาณิชย์">อาคารพาณิชย์</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="propertyPrice">ราคา (บาท) *</label>
                                    <input type="number" id="propertyPrice" placeholder="เช่น 5000000" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="propertyLocation">สถานที่ *</label>
                                    <input type="text" id="propertyLocation" placeholder="เช่น สุขุมวิท, กรุงเทพฯ" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="propertySize">พื้นที่ใช้สอย (ตร.ม.)</label>
                                    <input type="number" id="propertySize" placeholder="เช่น 120">
                                </div>
                                <div class="form-group">
                                    <label for="propertyBedrooms">จำนวนห้องนอน</label>
                                    <select id="propertyBedrooms">
                                        <option value="0">0 ห้อง</option>
                                        <option value="1">1 ห้อง</option>
                                        <option value="2">2 ห้อง</option>
                                        <option value="3">3 ห้อง</option>
                                        <option value="4">4 ห้อง</option>
                                        <option value="5+">5+ ห้อง</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="propertyBathrooms">จำนวนห้องน้ำ</label>
                                    <select id="propertyBathrooms">
                                        <option value="1">1 ห้อง</option>
                                        <option value="2">2 ห้อง</option>
                                        <option value="3">3 ห้อง</option>
                                        <option value="4">4 ห้อง</option>
                                        <option value="5+">5+ ห้อง</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="propertyDescription">รายละเอียด *</label>
                                <textarea id="propertyDescription" rows="3" placeholder="อธิบายรายละเอียดเกี่ยวกับอสังหาริมทรัพย์ของคุณ..." required></textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label>อัพโหลดรูปภาพ (สูงสุด 6 รูป)</label>
                                <div class="image-upload-area" id="imageUploadArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>คลิกเพื่อเลือกรูปภาพ หรือลากไฟล์มาวางที่นี่</p>
                                    <p style="font-size: 0.8rem; color: var(--gray);">รองรับไฟล์ JPG, PNG, GIF ขนาดไม่เกิน 5MB</p>
                                </div>
                                <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
                                <div id="image-preview"></div>
                            </div>
                            
                            <!-- Dropdown สำหรับเลือกรูปภาพ 360° -->
                            <div class="dropdown-container" id="panoramaDropdownContainer">
                                <label>เลือกรูปภาพสำหรับ 360° Viewer</label>
                                <div class="dropdown-header" id="panoramaDropdownHeader">
                                    <span id="panoramaSelected">เลือกรูปภาพจากที่อัพโหลด</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="dropdown-options" id="panoramaDropdownOptions">
                                    <!-- Options will be populated dynamically -->
                                </div>
                                <p class="dropdown-hint">เลือกรูปภาพที่อัพโหลดเพื่อใช้เป็นภาพสำหรับมุมมอง 360 องศา</p>
                            </div>
                            
                            <!-- Dropdown สำหรับเลือกรูปภาพสำหรับ 3D Tour -->
                            <div class="dropdown-container" id="tourDropdownContainer">
                                <label>เลือกรูปภาพสำหรับ 3D Tour</label>
                                <div class="dropdown-header" id="tourDropdownHeader">
                                    <span id="tourSelected">เลือกรูปภาพจากที่อัพโหลด</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="dropdown-options" id="tourDropdownOptions">
                                    <!-- Options will be populated dynamically -->
                                </div>
                                <p class="dropdown-hint">เลือกรูปภาพที่อัพโหลดเพื่อใช้ใน 3D Virtual Tour</p>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contactName">ชื่อผู้ติดต่อ *</label>
                                    <input type="text" id="contactName" placeholder="ชื่อ-นามสกุล" required>
                                </div>
                                <div class="form-group">
                                    <label for="contactPhone">เบอร์โทรศัพท์ *</label>
                                    <input type="tel" id="contactPhone" placeholder="เช่น 0891234567" required>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="contactEmail">อีเมล</label>
                                <input type="email" id="contactEmail" placeholder="เช่น example@email.com">
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="submit-btn">
                                    <i class="fas fa-paper-plane"></i> ลงประกาศฟรี
                                </button>
                                <button type="reset" class="reset-btn" id="resetForm">
                                    <i class="fas fa-redo"></i> ล้างแบบฟอร์ม
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner">
        <div class="spinner"></div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container hero-container">
            <div class="hero-text">
                <h2>ค้นหาบ้านในฝันด้วย<br>เทคโนโลยี 3D Virtual Tour</h2>
                <p>สัมผัสประสบการณ์การชมอสังหาริมทรัพย์แบบเสมือนจริง 360 องศา พร้อมระบบลงประกาศฟรี</p>
                <div class="hero-features">
                    <div class="feature">
                        <i class="fas fa-vr-cardboard"></i>
                        <span>Virtual Tour 3D</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-360-degrees"></i>
                        <span>มุมมอง 360 องศา</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-map-marked-alt"></i>
                        <span>แผนที่ตำแหน่งจริง</span>
                    </div>
                    <div class="feature">
                        <i class="fas fa-tag"></i>
                        <span>ลงประกาศฟรี</span>
                    </div>
                </div>
                <button class="cta-button" onclick="scrollToSection('properties')">
                    เริ่มค้นหาบ้าน <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div class="hero-3d">
                <div class="cube-container" id="cube3d">
                    <div class="cube-face front">
                        <img src="https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="บ้านเดี่ยวสไตล์โมเดิร์น">
                    </div>
                    <div class="cube-face back">
                        <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="บ้านหลังใหญ่พร้อมสวน">
                    </div>
                    <div class="cube-face right">
                        <img src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="ห้องนั่งเล่นกว้างขวาง">
                    </div>
                    <div class="cube-face left">
                        <img src="https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="ห้องครัวสไตล์โมเดิร์น">
                    </div>
                    <div class="cube-face top">
                        <img src="https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="มุมมองด้านบน">
                    </div>
                    <div class="cube-face bottom">
                        <img src="https://images.unsplash.com/photo-1600607687644-c7171b42498b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="สระว่ายน้ำส่วนตัว">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Properties Section -->
    <section class="properties-section" id="properties">
        <div class="container">
            <div class="section-title">
                <h2>อสังหาริมทรัพย์แนะนำ</h2>
                <p>ค้นพบบ้านและคอนโดที่พร้อมเข้าอยู่ทันที พร้อมเทคโนโลยี Virtual Tour แบบครบวงจร</p>
            </div>
            
            <div class="properties-grid" id="propertiesGrid">
                <!-- Properties will be loaded here dynamically -->
            </div>
            
            <div class="form-actions" style="justify-content: center; margin-top: 50px;">
                <button class="submit-btn" onclick="addSampleProperty()">
                    <i class="fas fa-plus-circle"></i> เพิ่มตัวอย่างอสังหา
                </button>
                <button class="reset-btn" onclick="clearAllProperties()">
                    <i class="fas fa-trash-alt"></i> ล้างทั้งหมด
                </button>
            </div>
        </div>
    </section>

    <!-- Map Section -->
    <section class="map-section" id="mapSection">
        <div class="container">
            <div class="section-title">
                <h2>แผนที่ค้นหาอสังหาริมทรัพย์</h2>
                <p>ค้นหาตำแหน่งอสังหาริมทรัพย์ทั้งหมดบนแผนที่แบบอินเตอร์แอคทีฟ</p>
            </div>
            
            <div class="map-container">
                <div id="interactive-map"></div>
            </div>
        </div>
    </section>

    <!-- Property Detail Modal -->
    <div class="property-modal" id="propertyModal">
        <div class="property-modal-content">
            <button class="close-modal" id="closePropertyModal">&times;</button>
            
            <div class="modal-property-images">
                <div class="modal-slider-container" id="modalSlider">
                    <!-- Images will be loaded here -->
                </div>
                
                <div class="modal-slider-nav" id="modalSliderNav">
                    <!-- Dots will be loaded here -->
                </div>
            </div>
            
            <div class="modal-property-details">
                <div class="modal-property-header">
                    <h3 id="modalTitle"></h3>
                    <div class="modal-price" id="modalPrice"></div>
                </div>
                
                <div class="modal-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="modalLocation"></span>
                </div>
                
                <p class="modal-description" id="modalDescription"></p>
                
                <div class="modal-features-grid" id="modalFeatures">
                    <!-- Features will be loaded here -->
                </div>
                
                <div class="modal-map" id="modalMapContainer"></div>
                
                <div class="modal-actions">
                    <button class="btn btn-accent" id="whatsappBtn">
                        <i class="fab fa-whatsapp"></i> ส่งข้อความ
                    </button>
                    <button class="btn btn-primary" id="callBtn">
                        <i class="fas fa-phone"></i> โทรติดต่อ
                    </button>
                    <button class="btn btn-primary" id="view360Btn">
                        <i class="fas fa-360-degrees"></i> ดู 360°
                    </button>
                    <button class="btn btn-accent" id="view3dBtn">
                        <i class="fas fa-vr-cardboard"></i> 3D Tour
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 360 Viewer Modal -->
    <div class="viewer-360-modal" id="viewer360Modal">
        <div class="viewer-content">
            <div class="viewer-header">
                <h3>มุมมอง 360 องศา</h3>
                <button class="close-viewer" id="closeViewer">&times;</button>
            </div>
            <div class="viewer-body">
                <div class="panorama-viewer" id="panoramaViewer">
                    <div class="panorama-sphere" id="panoramaSphere"></div>
                </div>
                <div class="viewer-instruction">
                    <i class="fas fa-mouse-pointer"></i> ลากเมาส์เพื่อหมุนมุมมอง 360 องศา
                </div>
                <div class="viewer-controls">
                    <button class="viewer-control-btn" id="panLeft">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button class="viewer-control-btn" id="panRight">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="viewer-control-btn" id="panUp">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="viewer-control-btn" id="panDown">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                    <button class="viewer-control-btn" id="resetPan">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3D Tour Modal -->
    <div class="tour-3d-modal" id="tour3dModal">
        <div class="tour-content">
            <div class="tour-header">
                <h3 id="tourTitle">3D Virtual Tour</h3>
                <button class="close-tour" id="closeTour">&times;</button>
            </div>
            <div id="tour3d-container"></div>
            <div class="tour-controls">
                <button class="tour-btn" id="prevRoom">
                    <i class="fas fa-chevron-left"></i> ห้องก่อนหน้า
                </button>
                <button class="tour-btn" id="nextRoom">
                    ห้องถัดไป <i class="fas fa-chevron-right"></i>
                </button>
                <button class="tour-btn" id="resetTour">
                    <i class="fas fa-sync-alt"></i> รีเซ็ตมุมมอง
                </button>
                <button class="tour-btn" id="autoRotate">
                    <i class="fas fa-sync"></i> หมุนอัตโนมัติ
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="brand">
                        <div class="logo">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="brand-text">
                            <h3>วิมานอสังหาริมทรัพย์</h3>
                        </div>
                    </div>
                    <p>แพลตฟอร์มอสังหาริมทรัพย์ครบวงจร พร้อมเทคโนโลยี 3D Virtual Tour และระบบลงประกาศฟรี</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-line"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-col">
                    <h3>บริการของเรา</h3>
                    <ul>
                        <li><a href="#" onclick="openFormDropdown()">ลงประกาศฟรี</a></li>
                        <li><a href="#properties">ค้นหาบ้าน</a></li>
                        <li><a href="#">3D Virtual Tour</a></li>
                        <li><a href="#">360° View</a></li>
                        <li><a href="#">ประเมินราคาบ้าน</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h3>ลิงก์ด่วน</h3>
                    <ul>
                        <li><a href="#home">หน้าแรก</a></li>
                        <li><a href="#" onclick="openFormDropdown()">ลงขายบ้าน</a></li>
                        <li><a href="#properties">อสังหาริมทรัพย์</a></li>
                        <li><a href="#contact">ติดต่อเรา</a></li>
                        <li><a href="#">ข้อกำหนดการใช้งาน</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h3>ติดต่อเรา</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 ถนนสุขุมวิท แขวงคลองเตย กรุงเทพฯ 10110</li>
                        <li><i class="fas fa-phone"></i> 02-123-4567</li>
                        <li><i class="fas fa-envelope"></i> info@wiman-property.com</li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>© 2023 วิมานอสังหาริมทรัพย์. สงวนลิขสิทธิ์ทุกประการ.</p>
            </div>
        </div>
    </footer>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Three.js for 3D Tour -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    
    <script>
        // ข้อมูลอสังหาริมทรัพย์เริ่มต้น
        let properties = [
            {
                id: 1,
                title: "บ้านเดี่ยวหรู สไตล์โมเดิร์น",
                price: "15,900,000",
                location: "สุขุมวิท 101, บางนา, กรุงเทพฯ",
                type: "บ้านเดี่ยว",
                size: "300 ตร.ม.",
                bedrooms: 4,
                bathrooms: 3,
                parking: 2,
                description: "บ้านเดี่ยวสไตล์โมเดิร์น 2 ชั้น 4 ห้องนอน 3 ห้องน้ำ พร้อมสระว่ายน้ำส่วนตัว สวนสวย ใกล้สถานีรถไฟฟ้า BTS",
                images: [
                    "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1600607687644-c7171b42498b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                panorama: "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80",
                tourImages: [
                    "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    "https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    "https://images.unsplash.com/photo-1600607687644-c7171b42498b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    "https://images.unsplash.com/photo-1600047509807-ba8f99d2cdde?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
                ],
                lat: 13.746429,
                lng: 100.645980,
                contactName: "สมชาย ใจดี",
                contactPhone: "0891234567",
                contactEmail: "somchai@email.com",
                date: "2023-10-15"
            },
            {
                id: 2,
                title: "คอนโดลักซ์ชัวรี่ ใจกลางเมือง",
                price: "8,500,000",
                location: "สีลม, สาทร, กรุงเทพฯ",
                type: "คอนโดมิเนียม",
                size: "45 ตร.ม.",
                bedrooms: 1,
                bathrooms: 1,
                parking: 1,
                description: "คอนโดหรู 1 ห้องนอน เฟอร์นิชครบ พร้อมสิ่งอำนวยความสะดวกครบครัน วิวเมืองสวย ใกล้รถไฟฟ้า BTS",
                images: [
                    "https://images.unsplash.com/photo-1600573472592-401b489a9bf7?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    "https://images.unsplash.com/photo-1600573472566-8dfeeae0c8e5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                ],
                panorama: "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80",
                tourImages: [
                    "https://images.unsplash.com/photo-1600573472592-401b489a9bf7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
                    "https://images.unsplash.com/photo-1600573472566-8dfeeae0c8e5?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80"
                ],
                lat: 13.726560,
                lng: 100.527430,
                contactName: "สุณี ทรัพย์สมบัติ",
                contactPhone: "0897654321",
                contactEmail: "sunee@email.com",
                date: "2023-10-10"
            }
        ];

        // เก็บ property ที่ผู้ใช้สร้างไว้
        let userProperties = JSON.parse(localStorage.getItem('wiman_properties')) || [];

        // รวม properties ทั้งหมด
        let allProperties = [...properties, ...userProperties];

        // 3D Tour Variables
        let tourScene, tourCamera, tourRenderer, tourControls;
        let tourCurrentRoom = 0;
        let tourImages = [];
        let autoRotateEnabled = false;
        let rotationSpeed = 0.002;

        // Dropdown Variables
        let uploadedImages = [];
        let selectedPanoramaIndex = -1;
        let selectedTourIndices = [];

        // 360 Viewer Variables
        let panoramaSphere = null;
        let isDragging = false;
        let startX = 0, startY = 0;
        let currentX = 0, currentY = 0;
        let rotationX = 0, rotationY = 0;
        let targetRotationX = 0, targetRotationY = 0;
        let inertia = 0;
        let isAnimating = false;

        // Initialize Everything
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-rotate 3D cube
            const cube = document.getElementById('cube3d');
            let rotationY = 0;
            
            setInterval(() => {
                rotationY += 0.2;
                cube.style.transform = `rotateX(-10deg) rotateY(${rotationY}deg)`;
            }, 50);
            
            // Load properties
            loadProperties();
            
            // Initialize interactive map
            setTimeout(initInteractiveMap, 500);
            
            // Initialize 3D Tour System
            init3DTourSystem();
            
            // Setup event listeners
            setupEventListeners();
            
            // Add structured data for SEO
            addStructuredData();
            
            // Initialize 360 viewer animation
            init360ViewerAnimation();
        });

        // Setup Event Listeners
        function setupEventListeners() {
            // Header scroll effect
            window.addEventListener('scroll', function() {
                const header = document.getElementById('header');
                if (window.scrollY > 50) {
                    header.classList.add('header-scrolled');
                } else {
                    header.classList.remove('header-scrolled');
                }
            });

            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mainNav = document.getElementById('mainNav');
            
            mobileMenuBtn.addEventListener('click', function() {
                mainNav.classList.toggle('active');
                const icon = mobileMenuBtn.querySelector('i');
                if (mainNav.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });

            // Close mobile menu when clicking on a link
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    mainNav.classList.remove('active');
                    const icon = mobileMenuBtn.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                });
            });

            // Property Form Dropdown
            const openFormDropdownBtn = document.getElementById('openFormDropdown');
            const closeFormDropdownBtn = document.getElementById('closeFormDropdown');
            const formDropdown = document.getElementById('formDropdown');
            
            openFormDropdownBtn.addEventListener('click', openFormDropdown);
            closeFormDropdownBtn.addEventListener('click', closeFormDropdown);
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.header-form-dropdown') && !formDropdown.contains(e.target)) {
                    closeFormDropdown();
                }
            });

            // Property Form Handling
            const propertyForm = document.getElementById('propertyForm');
            const imageUploadArea = document.getElementById('imageUploadArea');
            const imageInput = document.getElementById('imageInput');
            const imagePreview = document.getElementById('image-preview');
            const resetFormBtn = document.getElementById('resetForm');
            
            // Handle image upload
            imageUploadArea.addEventListener('click', () => {
                imageInput.click();
            });
            
            imageUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                imageUploadArea.style.borderColor = 'var(--primary)';
                imageUploadArea.style.backgroundColor = 'rgba(15, 76, 129, 0.1)';
            });
            
            imageUploadArea.addEventListener('dragleave', () => {
                imageUploadArea.style.borderColor = '#e0e0e0';
                imageUploadArea.style.backgroundColor = 'transparent';
            });
            
            imageUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                imageUploadArea.style.borderColor = '#e0e0e0';
                imageUploadArea.style.backgroundColor = 'transparent';
                
                const files = e.dataTransfer.files;
                handleImageFiles(files);
            });
            
            imageInput.addEventListener('change', (e) => {
                const files = e.target.files;
                handleImageFiles(files);
            });
            
            function handleImageFiles(files) {
                if (uploadedImages.length + files.length > 6) {
                    alert('คุณสามารถอัพโหลดรูปภาพได้สูงสุด 6 รูปเท่านั้น');
                    return;
                }
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    if (!file.type.match('image.*')) {
                        alert('กรุณาอัพโหลดไฟล์รูปภาพเท่านั้น');
                        continue;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) {
                        alert('ไฟล์รูปภาพต้องมีขนาดไม่เกิน 5MB');
                        continue;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        uploadedImages.push(e.target.result);
                        updateImagePreview();
                        updateDropdownOptions();
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            function updateImagePreview() {
                imagePreview.innerHTML = '';
                
                uploadedImages.forEach((image, index) => {
                    const img = document.createElement('img');
                    img.src = image;
                    img.className = 'preview-image';
                    img.addEventListener('click', () => {
                        uploadedImages.splice(index, 1);
                        updateImagePreview();
                        updateDropdownOptions();
                    });
                    imagePreview.appendChild(img);
                });
            }
            
            // Initialize dropdowns
            initDropdowns();
            
            // Reset form
            resetFormBtn.addEventListener('click', () => {
                uploadedImages = [];
                selectedPanoramaIndex = -1;
                selectedTourIndices = [];
                updateImagePreview();
                updateDropdownOptions();
            });
            
            // Handle form submission
            propertyForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                showLoading(true);
                
                // Validate form
                if (uploadedImages.length === 0) {
                    alert('กรุณาอัพโหลดรูปภาพอย่างน้อย 1 รูป');
                    showLoading(false);
                    return;
                }
                
                // Get form values
                const newProperty = {
                    id: Date.now(),
                    title: document.getElementById('propertyTitle').value,
                    type: document.getElementById('propertyType').value,
                    price: formatPrice(document.getElementById('propertyPrice').value),
                    location: document.getElementById('propertyLocation').value,
                    size: document.getElementById('propertySize').value + ' ตร.ม.',
                    bedrooms: parseInt(document.getElementById('propertyBedrooms').value),
                    bathrooms: parseInt(document.getElementById('propertyBathrooms').value),
                    description: document.getElementById('propertyDescription').value,
                    images: uploadedImages,
                    panorama: selectedPanoramaIndex !== -1 ? uploadedImages[selectedPanoramaIndex] : null,
                    tourImages: selectedTourIndices.length > 0 ? 
                        selectedTourIndices.map(index => uploadedImages[index]) : 
                        uploadedImages.slice(0, Math.min(uploadedImages.length, 4)),
                    lat: getRandomLat(),
                    lng: getRandomLng(),
                    contactName: document.getElementById('contactName').value,
                    contactPhone: document.getElementById('contactPhone').value,
                    contactEmail: document.getElementById('contactEmail').value,
                    date: new Date().toISOString().split('T')[0]
                };
                
                // Add parking spaces based on property type
                if (newProperty.type === 'บ้านเดี่ยว') {
                    newProperty.parking = 2;
                } else if (newProperty.type === 'ทาวน์เฮ้าส์') {
                    newProperty.parking = 2;
                } else if (newProperty.type === 'คอนโดมิเนียม') {
                    newProperty.parking = 1;
                } else {
                    newProperty.parking = 0;
                }
                
                // Save to localStorage
                userProperties.push(newProperty);
                localStorage.setItem('wiman_properties', JSON.stringify(userProperties));
                
                // Update all properties
                allProperties = [...properties, ...userProperties];
                
                // Reload property grid
                loadProperties();
                
                // Reset form
                propertyForm.reset();
                uploadedImages = [];
                selectedPanoramaIndex = -1;
                selectedTourIndices = [];
                updateImagePreview();
                updateDropdownOptions();
                
                showLoading(false);
                
                // Show success message
                alert('ประกาศของคุณถูกเพิ่มเรียบร้อยแล้ว!');
                
                // Close dropdown
                closeFormDropdown();
                
                // Scroll to properties section
                scrollToSection('properties');
            });

            // Modal controls
            document.getElementById('closePropertyModal').addEventListener('click', closePropertyModal);
            document.getElementById('closeViewer').addEventListener('click', close360Viewer);
            document.getElementById('closeTour').addEventListener('click', close3DTour);

            // Close modals when clicking outside
            document.querySelectorAll('.property-modal, .viewer-360-modal, .tour-3d-modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        if (modal.id === 'propertyModal') closePropertyModal();
                        if (modal.id === 'viewer360Modal') close360Viewer();
                        if (modal.id === 'tour3dModal') close3DTour();
                    }
                });
            });

            // 360 Viewer controls
            document.getElementById('panLeft').addEventListener('click', () => pan360View(-30, 0));
            document.getElementById('panRight').addEventListener('click', () => pan360View(30, 0));
            document.getElementById('panUp').addEventListener('click', () => pan360View(0, -30));
            document.getElementById('panDown').addEventListener('click', () => pan360View(0, 30));
            document.getElementById('resetPan').addEventListener('click', resetPanorama);

            // 3D Tour controls
            document.getElementById('prevRoom').addEventListener('click', () => changeTourRoom(-1));
            document.getElementById('nextRoom').addEventListener('click', () => changeTourRoom(1));
            document.getElementById('resetTour').addEventListener('click', resetTourView);
            document.getElementById('autoRotate').addEventListener('click', toggleAutoRotate);
        }

        // Form Dropdown Functions
        function openFormDropdown() {
            const formDropdown = document.getElementById('formDropdown');
            formDropdown.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeFormDropdown() {
            const formDropdown = document.getElementById('formDropdown');
            formDropdown.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Dropdown Functions
        function initDropdowns() {
            // Panorama dropdown
            const panoramaDropdownHeader = document.getElementById('panoramaDropdownHeader');
            const panoramaDropdownOptions = document.getElementById('panoramaDropdownOptions');
            
            panoramaDropdownHeader.addEventListener('click', function() {
                this.classList.toggle('active');
                panoramaDropdownOptions.classList.toggle('active');
            });
            
            // Tour dropdown
            const tourDropdownHeader = document.getElementById('tourDropdownHeader');
            const tourDropdownOptions = document.getElementById('tourDropdownOptions');
            
            tourDropdownHeader.addEventListener('click', function() {
                this.classList.toggle('active');
                tourDropdownOptions.classList.toggle('active');
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dropdown-container')) {
                    document.querySelectorAll('.dropdown-header').forEach(header => {
                        header.classList.remove('active');
                    });
                    document.querySelectorAll('.dropdown-options').forEach(options => {
                        options.classList.remove('active');
                    });
                }
            });
        }
        
        function updateDropdownOptions() {
            // Update panorama dropdown
            const panoramaDropdownOptions = document.getElementById('panoramaDropdownOptions');
            panoramaDropdownOptions.innerHTML = '';
            
            if (uploadedImages.length === 0) {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.textContent = 'ยังไม่มีรูปภาพที่อัพโหลด';
                panoramaDropdownOptions.appendChild(option);
                document.getElementById('panoramaSelected').textContent = 'เลือกรูปภาพจากที่อัพโหลด';
            } else {
                uploadedImages.forEach((image, index) => {
                    const option = document.createElement('div');
                    option.className = `dropdown-option ${selectedPanoramaIndex === index ? 'selected' : ''}`;
                    option.innerHTML = `
                        <img src="${image}" alt="รูปภาพที่ ${index + 1}">
                        รูปภาพที่ ${index + 1}
                    `;
                    option.addEventListener('click', () => {
                        selectedPanoramaIndex = index;
                        document.getElementById('panoramaSelected').textContent = `รูปภาพที่ ${index + 1}`;
                        updateDropdownOptions();
                        document.getElementById('panoramaDropdownHeader').classList.remove('active');
                        panoramaDropdownOptions.classList.remove('active');
                    });
                    panoramaDropdownOptions.appendChild(option);
                });
                
                if (selectedPanoramaIndex === -1) {
                    document.getElementById('panoramaSelected').textContent = 'เลือกรูปภาพจากที่อัพโหลด';
                }
            }
            
            // Update tour dropdown
            const tourDropdownOptions = document.getElementById('tourDropdownOptions');
            tourDropdownOptions.innerHTML = '';
            
            if (uploadedImages.length === 0) {
                const option = document.createElement('div');
                option.className = 'dropdown-option';
                option.textContent = 'ยังไม่มีรูปภาพที่อัพโหลด';
                tourDropdownOptions.appendChild(option);
                document.getElementById('tourSelected').textContent = 'เลือกรูปภาพจากที่อัพโหลด';
            } else {
                uploadedImages.forEach((image, index) => {
                    const isSelected = selectedTourIndices.includes(index);
                    const option = document.createElement('div');
                    option.className = `dropdown-option ${isSelected ? 'selected' : ''}`;
                    option.innerHTML = `
                        <img src="${image}" alt="รูปภาพที่ ${index + 1}">
                        รูปภาพที่ ${index + 1}
                        ${isSelected ? '<i class="fas fa-check" style="float: right; color: var(--primary);"></i>' : ''}
                    `;
                    option.addEventListener('click', () => {
                        if (selectedTourIndices.includes(index)) {
                            // Remove from selection
                            selectedTourIndices = selectedTourIndices.filter(i => i !== index);
                        } else {
                            // Add to selection
                            selectedTourIndices.push(index);
                        }
                        
                        // Update selected text
                        if (selectedTourIndices.length === 0) {
                            document.getElementById('tourSelected').textContent = 'เลือกรูปภาพจากที่อัพโหลด';
                        } else {
                            document.getElementById('tourSelected').textContent = `เลือกรูปภาพแล้ว ${selectedTourIndices.length} รูป`;
                        }
                        
                        updateDropdownOptions();
                        document.getElementById('tourDropdownHeader').classList.remove('active');
                        tourDropdownOptions.classList.remove('active');
                    });
                    tourDropdownOptions.appendChild(option);
                });
                
                // Add option to select all
                const selectAllOption = document.createElement('div');
                selectAllOption.className = 'dropdown-option';
                selectAllOption.style.borderTop = '1px solid #eee';
                selectAllOption.style.marginTop = '10px';
                selectAllOption.style.paddingTop = '15px';
                selectAllOption.innerHTML = `
                    <i class="fas fa-check-double"></i>
                    เลือกทั้งหมด
                `;
                selectAllOption.addEventListener('click', () => {
                    selectedTourIndices = [...Array(uploadedImages.length).keys()];
                    document.getElementById('tourSelected').textContent = `เลือกรูปภาพแล้ว ${selectedTourIndices.length} รูป`;
                    updateDropdownOptions();
                    document.getElementById('tourDropdownHeader').classList.remove('active');
                    tourDropdownOptions.classList.remove('active');
                });
                tourDropdownOptions.appendChild(selectAllOption);
                
                if (selectedTourIndices.length === 0) {
                    document.getElementById('tourSelected').textContent = 'เลือกรูปภาพจากที่อัพโหลด';
                }
            }
        }

        // Property Management Functions
        function loadProperties() {
            const propertiesGrid = document.getElementById('propertiesGrid');
            propertiesGrid.innerHTML = '';
            
            allProperties.forEach((property, index) => {
                const propertyCard = document.createElement('div');
                propertyCard.className = 'property-card';
                propertyCard.id = `property-${property.id}`;
                
                // Create image slider
                let sliderImages = '';
                property.images.forEach((image, i) => {
                    sliderImages += `<img src="${image}" alt="${property.title} - ภาพที่ ${i+1}">`;
                });
                
                // Create slider dots
                let sliderDots = '';
                property.images.forEach((_, i) => {
                    sliderDots += `<div class="slider-dot ${i === 0 ? 'active' : ''}" onclick="goToSlide('slider-${property.id}', ${i})"></div>`;
                });
                
                // Determine available features
                const has360 = !!property.panorama;
                const has3DTour = property.tourImages && property.tourImages.length > 0;
                
                propertyCard.innerHTML = `
                    <div class="property-image-slider">
                        <div class="slider-container" id="slider-${property.id}">
                            ${sliderImages}
                        </div>
                        
                        <div class="slider-arrow left" onclick="prevSlide('slider-${property.id}')">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="slider-arrow right" onclick="nextSlide('slider-${property.id}')">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                        
                        <div class="slider-nav">
                            ${sliderDots}
                        </div>
                    </div>
                    
                    <div class="property-content">
                        <div class="property-header">
                            <h3>${property.title}</h3>
                            <div class="price">${property.price} บาท</div>
                        </div>
                        
                        <div class="property-location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${property.location}</span>
                        </div>
                        
                        <p>${property.description.substring(0, 100)}...</p>
                        
                        <div class="property-features">
                            <div class="feature-item">
                                <i class="fas fa-bed"></i>
                                <span>${property.bedrooms} ห้องนอน</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-bath"></i>
                                <span>${property.bathrooms} ห้องน้ำ</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-car"></i>
                                <span>${property.parking} ที่จอดรถ</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-vector-square"></i>
                                <span>${property.size}</span>
                            </div>
                        </div>
                        
                        <div class="property-buttons">
                            <button class="btn btn-primary" onclick="openPropertyModal(${property.id})">
                                <i class="fas fa-eye"></i> รายละเอียด
                            </button>
                            ${has360 ? `
                            <button class="btn btn-accent" onclick="open360Viewer('${property.panorama}', '${property.title}')">
                                <i class="fas fa-360-degrees"></i> 360°
                            </button>
                            ` : ''}
                            ${has3DTour ? `
                            <button class="btn btn-accent" onclick="open3DTour(${property.id})">
                                <i class="fas fa-vr-cardboard"></i> 3D Tour
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                propertiesGrid.appendChild(propertyCard);
                
                // Initialize slider
                setTimeout(() => {
                    initSlider(`slider-${property.id}`);
                }, 100);
            });
            
            // Initialize scroll animation
            initScrollAnimation();
        }

        // Property slider functionality
        const sliders = {};
        
        function initSlider(sliderId) {
            const totalSlides = document.querySelectorAll(`#${sliderId} img`).length;
            sliders[sliderId] = {
                currentSlide: 0,
                totalSlides: totalSlides,
                container: document.getElementById(sliderId)
            };
            
            updateSliderNav(sliderId);
        }
        
        function nextSlide(sliderId) {
            const slider = sliders[sliderId];
            slider.currentSlide = (slider.currentSlide + 1) % slider.totalSlides;
            updateSlider(sliderId);
        }
        
        function prevSlide(sliderId) {
            const slider = sliders[sliderId];
            slider.currentSlide = (slider.currentSlide - 1 + slider.totalSlides) % slider.totalSlides;
            updateSlider(sliderId);
        }
        
        function goToSlide(sliderId, slideIndex) {
            const slider = sliders[sliderId];
            slider.currentSlide = slideIndex;
            updateSlider(sliderId);
        }
        
        function updateSlider(sliderId) {
            const slider = sliders[sliderId];
            const translateX = -slider.currentSlide * (100 / slider.totalSlides);
            slider.container.style.transform = `translateX(${translateX}%)`;
            updateSliderNav(sliderId);
        }
        
        function updateSliderNav(sliderId) {
            const slider = sliders[sliderId];
            const sliderNav = document.querySelector(`#${sliderId}`).parentElement.querySelector('.slider-nav');
            const dots = sliderNav.querySelectorAll('.slider-dot');
            
            dots.forEach((dot, index) => {
                if (index === slider.currentSlide) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Property Modal
        let currentProperty = null;
        let modalMap = null;
        
        function openPropertyModal(propertyId) {
            showLoading(true);
            
            currentProperty = allProperties.find(p => p.id === propertyId);
            
            if (!currentProperty) {
                showLoading(false);
                return;
            }
            
            // Update modal content
            document.getElementById('modalTitle').textContent = currentProperty.title;
            document.getElementById('modalPrice').textContent = currentProperty.price + ' บาท';
            document.getElementById('modalLocation').textContent = currentProperty.location;
            document.getElementById('modalDescription').textContent = currentProperty.description;
            
            // Update modal images
            const modalSlider = document.getElementById('modalSlider');
            const modalSliderNav = document.getElementById('modalSliderNav');
            
            modalSlider.innerHTML = '';
            modalSliderNav.innerHTML = '';
            
            currentProperty.images.forEach((image, index) => {
                const slide = document.createElement('div');
                slide.className = 'modal-slide';
                slide.innerHTML = `<img src="${image}" alt="${currentProperty.title} - ภาพที่ ${index+1}">`;
                modalSlider.appendChild(slide);
                
                const dot = document.createElement('div');
                dot.className = `modal-dot ${index === 0 ? 'active' : ''}`;
                dot.addEventListener('click', () => goToModalSlide(index));
                modalSliderNav.appendChild(dot);
            });
            
            // Update modal features
            const modalFeatures = document.getElementById('modalFeatures');
            modalFeatures.innerHTML = `
                <div class="modal-feature">
                    <i class="fas fa-home"></i>
                    <span>ประเภท: ${currentProperty.type}</span>
                </div>
                <div class="modal-feature">
                    <i class="fas fa-vector-square"></i>
                    <span>พื้นที่: ${currentProperty.size}</span>
                </div>
                <div class="modal-feature">
                    <i class="fas fa-bed"></i>
                    <span>ห้องนอน: ${currentProperty.bedrooms} ห้อง</span>
                </div>
                <div class="modal-feature">
                    <i class="fas fa-bath"></i>
                    <span>ห้องน้ำ: ${currentProperty.bathrooms} ห้อง</span>
                </div>
                <div class="modal-feature">
                    <i class="fas fa-car"></i>
                    <span>ที่จอดรถ: ${currentProperty.parking} คัน</span>
                </div>
                <div class="modal-feature">
                    <i class="fas fa-user"></i>
                    <span>ผู้ติดต่อ: ${currentProperty.contactName}</span>
                </div>
            `;
            
            // Update action buttons
            document.getElementById('whatsappBtn').onclick = () => {
                const message = `สวัสดีค่ะ/ครับ สนใจ${currentProperty.title} ราคา ${currentProperty.price} บาท ที่ ${currentProperty.location}`;
                const encodedMessage = encodeURIComponent(message);
                window.open(`https://wa.me/66${currentProperty.contactPhone.substring(1)}?text=${encodedMessage}`, '_blank');
            };
            
            document.getElementById('callBtn').onclick = () => {
                window.location.href = `tel:${currentProperty.contactPhone}`;
            };
            
            document.getElementById('view360Btn').onclick = () => {
                closePropertyModal();
                setTimeout(() => {
                    open360Viewer(currentProperty.panorama, currentProperty.title);
                }, 300);
            };
            
            document.getElementById('view3dBtn').onclick = () => {
                closePropertyModal();
                setTimeout(() => {
                    open3DTour(currentProperty.id);
                }, 300);
            };
            
            // Show/hide 360 and 3D buttons based on availability
            document.getElementById('view360Btn').style.display = currentProperty.panorama ? 'flex' : 'none';
            document.getElementById('view3dBtn').style.display = currentProperty.tourImages && currentProperty.tourImages.length > 0 ? 'flex' : 'none';
            
            // Initialize modal map
            const modalMapContainer = document.getElementById('modalMapContainer');
            modalMapContainer.innerHTML = '<div id="modal-map" style="width:100%;height:100%;"></div>';
            
            setTimeout(() => {
                if (modalMap) {
                    modalMap.remove();
                }
                
                modalMap = L.map('modal-map').setView([currentProperty.lat, currentProperty.lng], 15);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(modalMap);
                
                L.marker([currentProperty.lat, currentProperty.lng]).addTo(modalMap)
                    .bindPopup(`<b>${currentProperty.title}</b><br>${currentProperty.location}`)
                    .openPopup();
                
                showLoading(false);
                
                // Show modal
                document.getElementById('propertyModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            }, 100);
        }
        
        function goToModalSlide(index) {
            const modalSlider = document.getElementById('modalSlider');
            const totalSlides = document.querySelectorAll('.modal-slide').length;
            modalSlider.style.transform = `translateX(-${index * (100 / totalSlides)}%)`;
            
            const dots = document.querySelectorAll('.modal-dot');
            dots.forEach((dot, i) => {
                if (i === index) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        function closePropertyModal() {
            document.getElementById('propertyModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            
            if (modalMap) {
                modalMap.remove();
                modalMap = null;
            }
        }

        // 360 Viewer - IMPROVED SMOOTH VERSION
        function init360ViewerAnimation() {
            // Animation loop for smooth 360 rotation
            function animate360Viewer() {
                if (!isAnimating) {
                    requestAnimationFrame(animate360Viewer);
                    return;
                }
                
                // Smoothly interpolate to target rotation
                rotationX += (targetRotationX - rotationX) * 0.1;
                rotationY += (targetRotationY - rotationY) * 0.1;
                
                // Apply rotation to panorama sphere
                if (panoramaSphere) {
                    panoramaSphere.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
                }
                
                // Apply inertia
                if (inertia > 0) {
                    targetRotationY += inertia;
                    inertia *= 0.95; // Gradually reduce inertia
                    if (inertia < 0.01) inertia = 0;
                }
                
                requestAnimationFrame(animate360Viewer);
            }
            
            animate360Viewer();
        }
        
        function open360Viewer(imageUrl, title) {
            showLoading(true);
            
            panoramaSphere = document.getElementById('panoramaSphere');
            panoramaSphere.style.backgroundImage = `url('${imageUrl}')`;
            document.querySelector('.viewer-header h3').textContent = `${title} - มุมมอง 360°`;
            
            // Reset position
            rotationX = 0;
            rotationY = 0;
            targetRotationX = 0;
            targetRotationY = 0;
            inertia = 0;
            
            // Start animation
            isAnimating = true;
            
            showLoading(false);
            
            document.getElementById('viewer360Modal').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Setup mouse/touch events
            setup360ViewerEvents();
        }
        
        function setup360ViewerEvents() {
            const panoramaViewer = document.getElementById('panoramaViewer');
            
            // Mouse events
            panoramaViewer.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                panoramaViewer.style.cursor = 'grabbing';
                inertia = 0; // Reset inertia when user starts dragging
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                currentX = e.clientX;
                currentY = e.clientY;
                
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                
                // Update target rotation based on mouse movement
                targetRotationY += deltaX * 0.3;
                targetRotationX += deltaY * 0.3;
                
                // Store inertia for smooth continuation
                inertia = deltaX * 0.05;
                
                startX = currentX;
                startY = currentY;
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
                panoramaViewer.style.cursor = 'grab';
            });
            
            // Touch events for mobile
            panoramaViewer.addEventListener('touchstart', (e) => {
                isDragging = true;
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                inertia = 0;
                e.preventDefault();
            });
            
            panoramaViewer.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                currentX = e.touches[0].clientX;
                currentY = e.touches[0].clientY;
                
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;
                
                targetRotationY += deltaX * 0.3;
                targetRotationX += deltaY * 0.3;
                
                inertia = deltaX * 0.05;
                
                startX = currentX;
                startY = currentY;
                e.preventDefault();
            });
            
            panoramaViewer.addEventListener('touchend', () => {
                isDragging = false;
            });
        }
        
        function pan360View(deltaX, deltaY) {
            targetRotationY += deltaX;
            targetRotationX += deltaY;
        }
        
        function resetPanorama() {
            targetRotationX = 0;
            targetRotationY = 0;
            inertia = 0;
        }
        
        function close360Viewer() {
            document.getElementById('viewer360Modal').classList.remove('active');
            document.body.style.overflow = 'auto';
            isAnimating = false;
            
            // Clean up event listeners
            const panoramaViewer = document.getElementById('panoramaViewer');
            panoramaViewer.style.cursor = 'grab';
        }

        // 3D Tour System - IMPROVED WITH REALISTIC MODEL
        function init3DTourSystem() {
            // Scene setup will be done when opening tour
        }
        
        function open3DTour(propertyId) {
            showLoading(true);
            
            const property = allProperties.find(p => p.id === propertyId);
            if (!property || !property.tourImages || property.tourImages.length === 0) {
                alert('อสังหาริมทรัพย์นี้ไม่มี 3D Tour');
                showLoading(false);
                return;
            }
            
            document.getElementById('tourTitle').textContent = `${property.title} - 3D Virtual Tour`;
            tourImages = property.tourImages;
            tourCurrentRoom = 0;
            
            init3DScene();
            loadRoomImage(tourCurrentRoom);
            
            showLoading(false);
            
            document.getElementById('tour3dModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function init3DScene() {
            // Remove existing renderer if any
            const container = document.getElementById('tour3d-container');
            container.innerHTML = '';
            
            // Create scene
            tourScene = new THREE.Scene();
            
            // Create camera
            tourCamera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            tourCamera.position.set(0, 2, 5);
            
            // Create renderer
            tourRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            tourRenderer.setSize(container.clientWidth, container.clientHeight);
            tourRenderer.setClearColor(0x1a1a1a, 1);
            container.appendChild(tourRenderer.domElement);
            
            // Add controls
            tourControls = new THREE.OrbitControls(tourCamera, tourRenderer.domElement);
            tourControls.enableDamping = true;
            tourControls.dampingFactor = 0.05;
            tourControls.enableZoom = true;
            tourControls.enablePan = false;
            tourControls.autoRotate = false;
            tourControls.maxPolarAngle = Math.PI / 2;
            tourControls.minDistance = 1;
            tourControls.maxDistance = 10;
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            tourScene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 20, 15);
            tourScene.add(directionalLight);
            
            // Add a simple room structure
            createRoomStructure();
            
            // Handle window resize
            window.addEventListener('resize', onTourWindowResize);
            
            // Start animation
            animateTour();
        }
        
        function createRoomStructure() {
            // Create floor
            const floorGeometry = new THREE.PlaneGeometry(10, 10);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x888888,
                roughness: 0.8
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -0.5;
            tourScene.add(floor);
            
            // Create walls
            const wallGeometry = new THREE.BoxGeometry(10, 5, 0.2);
            const wallMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xf0f0f0,
                roughness: 0.7
            });
            
            // Back wall
            const backWall = new THREE.Mesh(wallGeometry, wallMaterial);
            backWall.position.z = -5;
            backWall.position.y = 2;
            tourScene.add(backWall);
            
            // Left wall
            const leftWall = new THREE.Mesh(wallGeometry, wallMaterial);
            leftWall.rotation.y = Math.PI / 2;
            leftWall.position.x = -5;
            leftWall.position.y = 2;
            tourScene.add(leftWall);
            
            // Right wall
            const rightWall = new THREE.Mesh(wallGeometry, wallMaterial);
            rightWall.rotation.y = Math.PI / 2;
            rightWall.position.x = 5;
            rightWall.position.y = 2;
            tourScene.add(rightWall);
            
            // Ceiling
            const ceilingGeometry = new THREE.PlaneGeometry(10, 10);
            const ceilingMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xffffff,
                roughness: 0.9
            });
            const ceiling = new THREE.Mesh(ceilingGeometry, ceilingMaterial);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = 4.5;
            tourScene.add(ceiling);
        }
        
        function loadRoomImage(roomIndex) {
            // Remove existing image frames
            const existingFrames = tourScene.children.filter(child => child.userData && child.userData.isImageFrame);
            existingFrames.forEach(frame => tourScene.remove(frame));
            
            if (roomIndex < 0 || roomIndex >= tourImages.length) return;
            
            // Create a frame for the image
            const textureLoader = new THREE.TextureLoader();
            textureLoader.load(tourImages[roomIndex], function(texture) {
                // Create image plane
                const aspectRatio = texture.image.width / texture.image.height;
                const planeWidth = 4;
                const planeHeight = planeWidth / aspectRatio;
                
                const planeGeometry = new THREE.PlaneGeometry(planeWidth, planeHeight);
                const planeMaterial = new THREE.MeshBasicMaterial({
                    map: texture,
                    side: THREE.DoubleSide
                });
                
                const imagePlane = new THREE.Mesh(planeGeometry, planeMaterial);
                imagePlane.position.set(0, 1.5, -4.8); // Place on back wall
                imagePlane.userData.isImageFrame = true;
                tourScene.add(imagePlane);
                
                // Add a frame around the image
                const frameGeometry = new THREE.BoxGeometry(planeWidth + 0.2, planeHeight + 0.2, 0.1);
                const frameMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x8B4513, // Wood color
                    roughness: 0.5
                });
                
                const frame = new THREE.Mesh(frameGeometry, frameMaterial);
                frame.position.copy(imagePlane.position);
                frame.position.z += 0.05; // Slightly in front of the image
                frame.userData.isImageFrame = true;
                tourScene.add(frame);
                
                // Add some decorative elements
                addRoomFurniture(roomIndex);
            });
        }
        
        function addRoomFurniture(roomIndex) {
            // Add different furniture based on room index
            if (roomIndex === 0) {
                // Living room furniture
                addSofa();
                addCoffeeTable();
                addTV();
            } else if (roomIndex === 1) {
                // Bedroom furniture
                addBed();
                addNightstand();
            } else if (roomIndex === 2) {
                // Kitchen furniture
                addKitchenCabinet();
                addDiningTable();
            } else {
                // Default furniture
                addChair();
                addTable();
            }
        }
        
        function addSofa() {
            const sofaGeometry = new THREE.BoxGeometry(3, 1, 1);
            const sofaMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.8
            });
            const sofa = new THREE.Mesh(sofaGeometry, sofaMaterial);
            sofa.position.set(-2, 0, -2);
            sofa.rotation.y = Math.PI / 4;
            tourScene.add(sofa);
        }
        
        function addCoffeeTable() {
            const tableTopGeometry = new THREE.BoxGeometry(1.5, 0.1, 1);
            const tableTopMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.6
            });
            const tableTop = new THREE.Mesh(tableTopGeometry, tableTopMaterial);
            tableTop.position.set(0, 0.5, -2);
            tourScene.add(tableTop);
            
            // Table legs
            const legGeometry = new THREE.BoxGeometry(0.1, 0.5, 0.1);
            const legPositions = [
                [0.7, 0.25, 0.45],
                [-0.7, 0.25, 0.45],
                [0.7, 0.25, -0.45],
                [-0.7, 0.25, -0.45]
            ];
            
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, tableTopMaterial);
                leg.position.set(pos[0], pos[1], pos[2]);
                tourScene.add(leg);
            });
        }
        
        function addTV() {
            const tvGeometry = new THREE.BoxGeometry(2, 1.2, 0.1);
            const tvMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x222222,
                roughness: 0.3,
                metalness: 0.7
            });
            const tv = new THREE.Mesh(tvGeometry, tvMaterial);
            tv.position.set(3, 1.5, -4.8);
            tourScene.add(tv);
            
            // TV screen
            const screenGeometry = new THREE.PlaneGeometry(1.8, 1);
            const screenMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x0000ff,
                transparent: true,
                opacity: 0.5
            });
            const screen = new THREE.Mesh(screenGeometry, screenMaterial);
            screen.position.set(3, 1.5, -4.71);
            tourScene.add(screen);
        }
        
        function addBed() {
            const bedGeometry = new THREE.BoxGeometry(3, 0.5, 2);
            const bedMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x4169E1,
                roughness: 0.8
            });
            const bed = new THREE.Mesh(bedGeometry, bedMaterial);
            bed.position.set(0, 0, -2);
            tourScene.add(bed);
            
            // Bed headboard
            const headboardGeometry = new THREE.BoxGeometry(3.2, 1, 0.2);
            const headboard = new THREE.Mesh(headboardGeometry, bedMaterial);
            headboard.position.set(0, 0.5, -3);
            tourScene.add(headboard);
        }
        
        function addNightstand() {
            const nightstandGeometry = new THREE.BoxGeometry(0.8, 1, 0.8);
            const nightstandMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.6
            });
            const nightstand = new THREE.Mesh(nightstandGeometry, nightstandMaterial);
            nightstand.position.set(2, 0, -2);
            tourScene.add(nightstand);
            
            // Lamp on nightstand
            const lampBaseGeometry = new THREE.CylinderGeometry(0.1, 0.15, 0.1, 8);
            const lampBaseMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x888888,
                metalness: 0.8,
                roughness: 0.2
            });
            const lampBase = new THREE.Mesh(lampBaseGeometry, lampBaseMaterial);
            lampBase.position.set(2, 1.1, -2);
            tourScene.add(lampBase);
            
            const lampShadeGeometry = new THREE.ConeGeometry(0.3, 0.4, 8);
            const lampShadeMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xf5f5dc,
                roughness: 0.9
            });
            const lampShade = new THREE.Mesh(lampShadeGeometry, lampShadeMaterial);
            lampShade.position.set(2, 1.4, -2);
            tourScene.add(lampShade);
        }
        
        function addKitchenCabinet() {
            const cabinetGeometry = new THREE.BoxGeometry(4, 3, 0.5);
            const cabinetMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xf5f5dc,
                roughness: 0.7
            });
            const cabinet = new THREE.Mesh(cabinetGeometry, cabinetMaterial);
            cabinet.position.set(0, 1.5, -4.8);
            tourScene.add(cabinet);
        }
        
        function addDiningTable() {
            const tableGeometry = new THREE.CylinderGeometry(0.8, 0.8, 0.05, 16);
            const tableMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.6
            });
            const table = new THREE.Mesh(tableGeometry, tableMaterial);
            table.position.set(0, 0.5, 0);
            tourScene.add(table);
            
            // Table legs
            const legGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.5, 8);
            const legPositions = [
                [0.6, 0.25, 0.6],
                [-0.6, 0.25, 0.6],
                [0.6, 0.25, -0.6],
                [-0.6, 0.25, -0.6]
            ];
            
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, tableMaterial);
                leg.position.set(pos[0], pos[1], pos[2]);
                tourScene.add(leg);
            });
            
            // Add chairs
            for (let i = 0; i < 4; i++) {
                const angle = (i * Math.PI) / 2;
                const chairX = Math.cos(angle) * 1.2;
                const chairZ = Math.sin(angle) * 1.2;
                addChair(chairX, 0.3, chairZ, angle);
            }
        }
        
        function addChair(x = 1, y = 0, z = 1, rotation = 0) {
            const chairSeatGeometry = new THREE.BoxGeometry(0.5, 0.1, 0.5);
            const chairMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.6
            });
            const chairSeat = new THREE.Mesh(chairSeatGeometry, chairMaterial);
            chairSeat.position.set(x, y, z);
            chairSeat.rotation.y = rotation;
            tourScene.add(chairSeat);
            
            // Chair back
            const chairBackGeometry = new THREE.BoxGeometry(0.5, 0.8, 0.1);
            const chairBack = new THREE.Mesh(chairBackGeometry, chairMaterial);
            chairBack.position.set(x, y + 0.45, z + (Math.cos(rotation) * 0.3));
            chairBack.rotation.y = rotation;
            tourScene.add(chairBack);
            
            // Chair legs
            const legGeometry = new THREE.CylinderGeometry(0.03, 0.03, 0.3, 8);
            const legPositions = [
                [x + 0.2, y - 0.15, z + 0.2],
                [x - 0.2, y - 0.15, z + 0.2],
                [x + 0.2, y - 0.15, z - 0.2],
                [x - 0.2, y - 0.15, z - 0.2]
            ];
            
            legPositions.forEach(pos => {
                const leg = new THREE.Mesh(legGeometry, chairMaterial);
                leg.position.set(pos[0], pos[1], pos[2]);
                leg.rotation.y = rotation;
                tourScene.add(leg);
            });
        }
        
        function addTable() {
            const tableGeometry = new THREE.BoxGeometry(1, 0.1, 1);
            const tableMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8B4513,
                roughness: 0.6
            });
            const table = new THREE.Mesh(tableGeometry, tableMaterial);
            table.position.set(0, 0.5, 0);
            tourScene.add(table);
        }
        
        function changeTourRoom(direction) {
            tourCurrentRoom += direction;
            
            if (tourCurrentRoom < 0) {
                tourCurrentRoom = tourImages.length - 1;
            } else if (tourCurrentRoom >= tourImages.length) {
                tourCurrentRoom = 0;
            }
            
            loadRoomImage(tourCurrentRoom);
        }
        
        function resetTourView() {
            tourCamera.position.set(0, 2, 5);
            tourControls.reset();
        }
        
        function toggleAutoRotate() {
            autoRotateEnabled = !autoRotateEnabled;
            tourControls.autoRotate = autoRotateEnabled;
            const btn = document.getElementById('autoRotate');
            if (autoRotateEnabled) {
                btn.innerHTML = '<i class="fas fa-stop"></i> หยุดหมุน';
            } else {
                btn.innerHTML = '<i class="fas fa-sync"></i> หมุนอัตโนมัติ';
            }
        }
        
        function onTourWindowResize() {
            const container = document.getElementById('tour3d-container');
            tourCamera.aspect = container.clientWidth / container.clientHeight;
            tourCamera.updateProjectionMatrix();
            tourRenderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function animateTour() {
            requestAnimationFrame(animateTour);
            tourControls.update();
            tourRenderer.render(tourScene, tourCamera);
        }
        
        function close3DTour() {
            document.getElementById('tour3dModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Clean up
            if (tourRenderer) {
                tourRenderer.dispose();
            }
            
            window.removeEventListener('resize', onTourWindowResize);
        }

        // Interactive Map
        let interactiveMap = null;
        let mapMarkers = [];
        
        function initInteractiveMap() {
            interactiveMap = L.map('interactive-map').setView([13.7563, 100.5018], 11);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(interactiveMap);
            
            // Add markers for all properties
            allProperties.forEach(property => {
                const marker = L.marker([property.lat, property.lng]).addTo(interactiveMap);
                
                marker.bindPopup(`
                    <div style="padding: 10px;">
                        <h4 style="margin: 0 0 5px; color: var(--primary);">${property.title}</h4>
                        <p style="margin: 0 0 5px; font-weight: bold; color: var(--primary);">${property.price} บาท</p>
                        <p style="margin: 0 0 5px;">${property.location}</p>
                        <button onclick="openPropertyModal(${property.id})" style="background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px;">
                            ดูรายละเอียด
                        </button>
                    </div>
                `);
                
                mapMarkers.push(marker);
            });
        }

        // Utility Functions
        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section) {
                window.scrollTo({
                    top: section.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        }
        
        function formatPrice(price) {
            return parseInt(price).toLocaleString('th-TH');
        }
        
        function getRandomLat() {
            return 13.7 + Math.random() * 0.2;
        }
        
        function getRandomLng() {
            return 100.5 + Math.random() * 0.2;
        }
        
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (show) {
                spinner.classList.add('active');
            } else {
                spinner.classList.remove('active');
            }
        }
        
        function initScrollAnimation() {
            const propertyCards = document.querySelectorAll('.property-card');
            
            function checkScroll() {
                propertyCards.forEach(card => {
                    const cardTop = card.getBoundingClientRect().top;
                    const windowHeight = window.innerHeight;
                    
                    if (cardTop < windowHeight - 100) {
                        card.classList.add('visible');
                    }
                });
            }
            
            window.addEventListener('scroll', checkScroll);
            checkScroll();
        }
        
        function addSampleProperty() {
            const sampleImages = [
                "https://images.unsplash.com/photo-1518780664697-55e3ad937233?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
            ];
            
            const sampleProperty = {
                id: Date.now(),
                title: "บ้านตัวอย่างใหม่ สวยงาม",
                type: "บ้านเดี่ยว",
                price: formatPrice(Math.floor(Math.random() * 10000000) + 3000000),
                location: "ทำเลตัวอย่าง, กรุงเทพฯ",
                size: Math.floor(Math.random() * 200) + 100 + " ตร.ม.",
                bedrooms: Math.floor(Math.random() * 4) + 1,
                bathrooms: Math.floor(Math.random() * 3) + 1,
                parking: Math.floor(Math.random() * 3) + 1,
                description: "บ้านตัวอย่างที่เพิ่มเข้ามาใหม่ พร้อมเทคโนโลยี 3D Virtual Tour และมุมมอง 360 องศา",
                images: sampleImages,
                panorama: sampleImages[0],
                tourImages: sampleImages,
                lat: getRandomLat(),
                lng: getRandomLng(),
                contactName: "ตัวอย่าง ผู้ขาย",
                contactPhone: "089" + Math.floor(Math.random() * 10000000).toString().padStart(7, '0'),
                contactEmail: "example@email.com",
                date: new Date().toISOString().split('T')[0]
            };
            
            userProperties.push(sampleProperty);
            localStorage.setItem('wiman_properties', JSON.stringify(userProperties));
            allProperties = [...properties, ...userProperties];
            loadProperties();
            
            // Update map
            if (interactiveMap) {
                const marker = L.marker([sampleProperty.lat, sampleProperty.lng]).addTo(interactiveMap);
                marker.bindPopup(`
                    <div style="padding: 10px;">
                        <h4 style="margin: 0 0 5px; color: var(--primary);">${sampleProperty.title}</h4>
                        <p style="margin: 0 0 5px; font-weight: bold; color: var(--primary);">${sampleProperty.price} บาท</p>
                        <p style="margin: 0 0 5px;">${sampleProperty.location}</p>
                        <button onclick="openPropertyModal(${sampleProperty.id})" style="background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px;">
                            ดูรายละเอียด
                        </button>
                    </div>
                `);
                mapMarkers.push(marker);
            }
            
            alert('เพิ่มอสังหาริมทรัพย์ตัวอย่างเรียบร้อยแล้ว!');
        }
        
        function clearAllProperties() {
            if (confirm('คุณแน่ใจว่าต้องการล้างรายการอสังหาริมทรัพย์ทั้งหมดที่คุณเพิ่ม?')) {
                userProperties = [];
                localStorage.setItem('wiman_properties', JSON.stringify(userProperties));
                allProperties = [...properties];
                loadProperties();
                
                // Clear map markers
                if (interactiveMap) {
                    mapMarkers.forEach(marker => {
                        interactiveMap.removeLayer(marker);
                    });
                    mapMarkers = [];
                    
                    // Re-add original property markers
                    properties.forEach(property => {
                        const marker = L.marker([property.lat, property.lng]).addTo(interactiveMap);
                        marker.bindPopup(`
                            <div style="padding: 10px;">
                                <h4 style="margin: 0 0 5px; color: var(--primary);">${property.title}</h4>
                                <p style="margin: 0 0 5px; font-weight: bold; color: var(--primary);">${property.price} บาท</p>
                                <p style="margin: 0 0 5px;">${property.location}</p>
                                <button onclick="openPropertyModal(${property.id})" style="background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 5px;">
                                    ดูรายละเอียด
                                </button>
                            </div>
                        `);
                        mapMarkers.push(marker);
                    });
                }
                
                alert('ล้างรายการอสังหาริมทรัพย์เรียบร้อยแล้ว!');
            }
        }
        
        function addStructuredData() {
            const structuredData = {
                "@context": "https://schema.org",
                "@type": "RealEstateAgent",
                "name": "วิมานอสังหาริมทรัพย์",
                "description": "บริการด้านอสังหาริมทรัพย์ครบวงจร พร้อมเทคโนโลยี 3D Virtual Tour และระบบลงประกาศฟรี",
                "address": {
                    "@type": "PostalAddress",
                    "streetAddress": "123 ถนนสุขุมวิท แขวงคลองเตย",
                    "addressLocality": "เขตคลองเตย",
                    "addressRegion": "กรุงเทพฯ",
                    "postalCode": "10110",
                    "addressCountry": "TH"
                },
                "telephone": "02-123-4567",
                "url": window.location.href,
                "priceRange": "฿฿",
                "openingHours": "Mo-Fr 08:30-17:30, Sa 09:00-15:00",
                "hasMap": "https://www.google.com/maps?q=13.746429,100.645980"
            };
            
            const script = document.createElement('script');
            script.type = "application/ld+json";
            script.textContent = JSON.stringify(structuredData);
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
